{% extends "base.html" %}
{% load static %}

{% block extra_head %}
<link rel="stylesheet" href="{% static 'registrar/css/elegir_mesas.css' %}">
{% endblock %}

{% block content %}
<div class="container">
  <!-- Panel Izquierdo: Datos Reserva -->
  <div class="left-panel">
    <h3 class="text-center mb-3 text-warning" style="font-family: 'Century Gothic', sans-serif; font-weight: bolder;">
      DATOS DE LA RESERVA
    </h3>
    <div class="reserva-info">
      <p><strong>Nombre de la reserva:</strong> {{ reserva.nombre_reserva }}</p>
      <p><strong>Fecha:</strong> {{ reserva.fecha }}</p>
      <p><strong>Hora:</strong> {{ reserva.hora }}</p>
      <p><strong>Zona:</strong> {{ reserva.zona.nombre }}</p>
      <p><strong>Comensales:</strong> {{ reserva.comensales }}</p>
      {% if reserva.menu %}
        <p><strong>Menú:</strong> {{ reserva.menu }}</p>
      {% endif %}
      <p><strong>Total capacidad seleccionada:</strong> 
        <span id="capacidadTotal" data-comensales="{{ reserva.comensales }}" data-margen-extra="1">0</span>
      </p>
    </div>
  </div>

  <!-- Panel Derecho: Filtros y Selección de Mesas -->
  <div class="right-panel">
    <h2 class="mb-4 text-warning text-center" style="font-family: 'Century Gothic', sans-serif; font-weight: bolder;">
      SELECCIONA LAS MESAS
    </h2>

    {% if error %}
      <div style="color:red; margin-bottom: 1rem;">{{ error }}</div>
    {% endif %}

    <form method="post" id="mesasForm">
      {% csrf_token %}

      <div class="filters">
        <label for="filtroCapacidad">Capacidad mínima:
          <select id="filtroCapacidad" name="capacidad_min" class="form-select d-inline-block w-auto ms-2">
            <option value="0">Cualquier capacidad</option>
            {% for c in capacidades_disponibles %}
              <option value="{{ c }}">{{ c }}+</option>
            {% endfor %}
          </select>
        </label>
      </div>

      <div class="mesas-grid" id="mesasGrid">
        {% for mesa in mesas %}
          <div 
            class="mesa-btn capacidad-{{ mesa.capacidad }}{% if not mesa.disponible %} unavailable{% endif %}" 
            data-zona="{{ mesa.zona.id }}"
            data-capacidad="{{ mesa.capacidad }}"
            data-id="{{ mesa.id }}"
            title="Mesa {{ mesa.numero }} - Capacidad: {{ mesa.capacidad }}"
          >
            <input type="checkbox" 
                   name="mesas" 
                   value="{{ mesa.id }}" 
                   style="display:none;"
                   {% if not mesa.disponible %} disabled {% endif %}
            >
            Mesa {{ mesa.numero }}
          </div>
        {% endfor %}
      </div>

      <div class="mt-4 text-center">
        <button class="btn btn-warning" type="submit">Confirmar Mesas</button>
      </div>
    </form>
  </div>
</div>

<!-- Script externo -->
<script src="{% static 'reservas/js/elegir_mesas.js' %}"></script>
{% endblock %}