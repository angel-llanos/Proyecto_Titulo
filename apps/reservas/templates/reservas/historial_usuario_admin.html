<!-- reservas/templates/reservas/historial_usuario_admin.html -->
{% extends 'base.html' %}
{% load static %}
{% block content %}

<div class="form-container">
  <div class="container mb-2">
    <h2 class="text-white text-center mb-3">Historial de Reservas de {{ usuario.username }}</h2>
    <div class="accordion" id="accordionReservas">
      {% for reserva in reservas %}
      <div class="accordion-item">
        <h2 class="accordion-header" id="heading{{ reserva.id }}">
          <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse{{ reserva.id }}">
            Reserva #{{ reserva.id }} - {{ reserva.fecha }} {{ reserva.hora }}
          </button>
        </h2>
        <div id="collapse{{ reserva.id }}" class="accordion-collapse collapse" data-bs-parent="#accordionReservas">
          <div class="accordion-body">
            <p><strong>ID:</strong> {{ reserva.id }}</p>
            <p><strong>Fecha:</strong> {{ reserva.fecha }}</p>
            <p><strong>Hora:</strong> {{ reserva.hora }}</p>
            <p><strong>Mesas:</strong> 
              {% for mesa in reserva.mesas.all %}
                {{ mesa.numero }}{% if not forloop.last %}, {% endif %}
              {% empty %}
                Sin mesas asignadas
              {% endfor %}
            </p>
            {% if reserva.menu %}
            <p><strong>Menú:</strong> {{ reserva.menu.nombre }} (${{ reserva.menu.precio }})</p>
            {% else %}
            <p><strong>Sin menú elegido</strong></p>
            {% endif %}
            <p><strong>Abono:</strong> ${{ reserva.abono }}</p>
            <p><strong>Estado:</strong> {{ reserva.estado|capfirst }}</p>

            {% if reserva.estado != 'cancelada' %}
            <form method="post" action="{% url 'cancelar_reserva_admin' reserva.id %}" style="display:inline;">
                {% csrf_token %}
                <button type="submit" class="btn btn-danger btn-sm" onclick="return confirm('¿Estás seguro de cancelar esta reserva?');">Cancelar Reserva</button>
            </form>
            {% else %}
            <span class="badge bg-secondary">Reserva Cancelada</span>
            {% endif %}
          </div>
        </div>
      </div>
      {% empty %}
      <p class="text-center" style="font-size: 18px; color: grey; font-style: italic;">Este usuario no tiene reservas registradas.</p>
      {% endfor %}
    </div>
  </div>
</div>

{% endblock %}
